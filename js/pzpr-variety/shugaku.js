/*! @license pzpr.js v1375cc80 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,s){"object"==typeof module&&module.exports?module.exports=[t,s]:pzpr.classmgr.makeCustom(t,s)}(["shugaku"],{MouseEvent:{inputModes:{edit:["number"],play:["futon","shade","unshade","clear"]},mouseinput:function(){switch(this.inputMode){case"number":case"number-":this.mouseinput_number();break;case"futon":this.mousestart||this.mousemove?this.inputFuton():this.mouseend&&this.inputFuton2();break;case"shade":case"unshade":case"clear":this.inputcell_shugaku();break;case"auto":this.mouseinput_auto()}},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputFuton():this.mouseend&&this.inputFuton2():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputcell_shugaku():this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputFuton:function(){var t,s,e,i,n=this.getcell();if(null===this.inputData)return n.isnull||n.isNum()?void 0:void(46===n.qans||1===n.qans||1===n.qsub?this.inputcell_shugaku():(this.mouseCell=n,this.inputData=41,this.firstPoint.set(this.inputPoint),n.draw()));this.inputData<=3?this.inputcell_shugaku():(t=this.inputData,s=null,n.isnull||(this.mouseCell===n?this.inputData=41:(n=this.inputPoint.bx-this.firstPoint.bx,e=this.inputPoint.by-this.firstPoint.by,i=this.mouseCell.adjacent,0<n-e&&0<n+e?(s=i.right,this.inputData=45):0<n-e&&n+e<0?(s=i.top,this.inputData=42):n-e<0&&0<n+e?(s=i.bottom,this.inputData=43):n-e<0&&n+e<0&&(s=i.left,this.inputData=44),(null===s||s.isnull||s.isNum())&&(this.inputData=46))),t!==this.inputData&&this.mouseCell.drawaround())},inputFuton2:function(){var t,s;this.mouseCell.isnull||!this.inputData||this.inputData<=3||(t=this.mouseCell,this.changeHalf(t),41!==this.inputData&&46!==this.inputData?(t.setQans(this.inputData),t.setQsub(0)):46===this.inputData?(t.setQans(41),t.setQsub(0)):41===t.qans?(t.setQans(46),t.setQsub(0)):"futon"===this.inputMode?(46===t.qans?t.setQans(0):t.setQans(41),t.setQsub(0)):46===t.qans?(t.setQans(1),t.setQsub(0)):1===t.qans?(t.setQans(0),t.setQsub(1)):(1===t.qsub?t.setQans(0):t.setQans(41),t.setQsub(0)),(s=this.currentTargetADJ()).isnull||(this.changeHalf(s),s.setQans({42:48,43:47,44:50,45:49}[this.inputData]),s.setQsub(0)),this.mousereset(),t.drawaround(),this.mouseCell=this.board.emptycell)},inputcell_shugaku:function(){var t=this.getcell();if(!t.isnull&&t!==this.mouseCell&&!t.isNum()){if(null===this.inputData)switch(this.inputMode){case"shade":this.inputData=1!==t.qans?1:3;break;case"unshade":this.inputData=1!==t.qsub?2:3;break;case"clear":case"futon":this.inputData=3;break;default:1===t.qans?this.inputData=2:1===t.qsub?this.inputData=3:this.inputData=1}this.changeHalf(t),(this.mouseCell=t).setQans(1===this.inputData?1:0),t.setQsub(2===this.inputData?1:0),t.drawaround()}},changeHalf:function(t){var s=t.qans,t=t.adjacent,e=null;42===s||47===s?e=t.top:43===s||48===s?e=t.bottom:44===s||49===s?e=t.left:45!==s&&50!==s||(e=t.right),null!==e&&(42<=e.qans&&e.qans<=45?e.setQans(41):47<=e.qans&&e.qans<=50&&e.setQans(46))},currentTargetADJ:function(){if(!this.mouseCell.isnull){var t=this.mouseCell.adjacent;switch(this.inputData){case 42:return t.top;case 43:return t.bottom;case 44:return t.left;case 45:return t.right}}return this.board.emptycell}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:4,minnum:0,isPillow:function(){return 41<=this.qans&&this.qans<=45},isPillowBySolver:function(){return 40===this.qansBySolver},isDotBySolver:function(){return 50===this.qansBySolver}},Border:{isbdh_cc1:{41:1,42:1,44:1,45:1,46:1,47:1,49:1,50:1},isbdh_cc2:{41:1,43:1,44:1,45:1,46:1,48:1,49:1,50:1},isbdv_cc1:{41:1,42:1,43:1,44:1,46:1,47:1,48:1,49:1},isbdv_cc2:{41:1,42:1,43:1,45:1,46:1,47:1,48:1,50:1},isBorder:function(){var t=this.sidecell[0].qans,s=this.sidecell[1].qans;return this.isVert()?!!this.isbdv_cc1[t]||!!this.isbdv_cc2[s]:!!this.isbdh_cc1[t]||!!this.isbdh_cc2[s]},isBorderBySolver:function(){function t(t,s){return 40===t?{1:45,2:44,3:42}[s]||0:50===t&&{1:49,2:50,3:48}[s]||0}var s=this.sidecell[0].qansBySolver,e=this.sidecell[0].qsubBySolver,i=this.sidecell[1].qansBySolver,n=this.sidecell[1].qsubBySolver,s=t(s,e),e=t(i,n);return this.isVert()?!!this.isbdv_cc1[s]||!!this.isbdv_cc2[e]:!!this.isbdh_cc1[s]||!!this.isbdh_cc2[e]}},Board:{hasborder:1},BoardExec:{allowedOperations:function(t){return t?this.FLIPX:this.ALLOWALL},adjustBoardData:function(t,s){var e={};switch(t){case this.FLIPY:e={42:43,43:42,47:48,48:47};break;case this.FLIPX:e={44:45,45:44,49:50,50:49};break;case this.TURNR:e={42:45,45:43,43:44,44:42,47:50,50:48,48:49,49:47};break;case this.TURNL:e={42:44,44:43,43:45,45:42,47:49,49:48,48:50,50:47};break;default:return}for(var i=this.board.cell,n=0;n<i.length;n++){var l=i[n],a=e[l.qans];a&&(l.qans=a)}}},AreaShadeGraph:{enabled:!0},Graphic:{hideHatena:!0,qanscolor:"black",bcolor:"rgb(208, 208, 208)",targetbgcolor:"rgb(255, 192, 192)",undefcolor:"silver",trialcolor:"rgb(80, 0, 80)",solvercolor:"rgb(136,136,228)",solverqanscolor:"rgb(6,119,142)",circleratio:[.47,.42],numbercolor_func:"qnum",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawDashedGrid(),this.drawFutons(),this.drawPillows(),this.drawBorders(),this.drawCircles(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()},getBGCellColor_error1:function(t){return this.puzzle.execConfig("undefcell")&&0===t.qans&&-1===t.qnum?this.undefcolor:1===t.error||1===t.qinfo?this.errbcolor1:null},drawFutons:function(){for(var t=this.vinc("cell_futon","crispEdges",!0),s=this.puzzle.mouse,e=null,i=null,n=!s.mouseCell.isnull&&null!==s.firstPoint.bx&&40<=s.inputData,l=(n&&(e=s.mouseCell,i=s.currentTargetADJ()),this.range.cells),a=0;a<l.length;a++){var r=l[a],u=41<=r.qans,o=1===r.error?this.errbcolor1:"white";!n||r!==e&&r!==i||(u=!0,o=this.targetbgcolor),t.vid="c_futon_"+r.id,u?(t.fillStyle=o,t.fillRectCenter(r.bx*this.bw,r.by*this.bh,this.bw,this.bh)):t.vhide()}},drawPillows:function(){for(var t=this.vinc("cell_pillow","crispEdges",!0),s=this.puzzle.mouse,e=null,i=null,n=!s.mouseCell.isnull&&null!==s.firstPoint.bx,l=(n&&(e=s.mouseCell,i=s.currentTargetADJ()),this.range.cells),a=.7*this.bw-1,r=.7*this.bh-1,u=0;u<l.length;u++){var o=l[u],h=o.isPillow()||o.isPillowBySolver();n&&(h||e!==o?h&&i===o&&(h=!1):h=!0),t.vid="c_pillow_"+o.id,h?(t.lineWidth=1,t.strokeStyle=o.trial?this.trialcolor:"black",n&&e===o?t.fillStyle=this.targetbgcolor:1===o.error?t.fillStyle=this.errbcolor1:t.fillStyle=this.getColorSolverAware(o.isPillow(),o.isPillowBySolver(),"white"),t.shapeRectCenter(o.bx*this.bw,o.by*this.bh,a,r)):t.vhide()}},getBorderColor:function(t){var s,e=t.isBorder()||t.isBorderBySolver(),i=this.puzzle.mouse,n=!1,l=t.sidecell[0],a=t.sidecell[1];return i.mouseCell.isnull||null===i.firstPoint.bx?n=(l.trial||0===l.qans&&0===l.qansBySolver)&&(a.trial||0===a.qans&&0===a.qansBySolver):(s=i.mouseCell,i=l===(i=i.currentTargetADJ())||a===i,(l=l===s||a===s)&&i?e=!1:(l||i)&&(e=!0,0<this.board.trialstage&&(n=!0))),e?n?this.trialcolor:this.getColorSolverAware(t.isBorder(),t.isBorderBySolver(),this.shadecolor):null},drawDotCells:function(){for(var t=this.vinc("cell_dot","auto",!0),s=Math.max(.06*this.cw,2),e=this.range.cells,i=0;i<e.length;i++){var n=e[i];t.vid="c_dot_"+n.id,n.isDot()||n.isDotBySolver()?(n.trial?t.fillStyle=this.trialcolor:t.fillStyle=this.getColorSolverAware(n.isDot(),n.isDotBySolver()),t.fillCircle(n.bx*this.bw,n.by*this.bh,s)):t.vhide()}}},Encode:{decodePzpr:function(t){this.decodeShugaku()},encodePzpr:function(t){this.encodeShugaku()},decodeShugaku:function(){for(var t=0,s=this.outbstr,e=this.board,i=0;i<s.length;i++){var n=s.charAt(i),l=e.cell[t];if("0"<=n&&n<="4"?l.qnum=parseInt(n,36):"5"===n?l.qnum=-2:t+=parseInt(n,36)-6,t++,!e.cell[t])break}this.outbstr=s.substr(i+1)},encodeShugaku:function(){for(var t="",s=0,e=this.board,i=0;i<e.cell.length;i++){var n="",l=e.cell[i].qnum;-2===l?n="5":-1!==l?n=l.toString(36):s++,0===s?t+=n:!n&&30!==s||(t+=(5+s).toString(36)+n,s=0)}0<s&&(t+=(5+s).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCell(function(t,s){"5"===s?t.qnum=-2:"#"===s?t.qans=1:"-"===s?t.qsub=1:"a"<=s&&s<="j"?t.qans=parseInt(s,20)+31:"."!==s&&(t.qnum=+s)})},encodeData:function(){this.encodeCell(function(t){return 0<=t.qnum?t.qnum+" ":-2===t.qnum?"5 ":1===t.qans?"# ":41<=t.qans?(t.qans-31).toString(20)+" ":1===t.qsub?"- ":". "})}},AnsCheck:{checklist:["checkKitamakura","check2x2ShadeCell","checkDir4PillowOver","checkFullSizeFuton","checkFutonAisle","checkConnectShade","checkDir4PillowLess","checkEmptyCell_shugaku+"],checkDir4PillowOver:function(){this.checkDir4Cell(function(t){return t.isPillow()},2,"nmPillowGt")},checkDir4PillowLess:function(){this.checkDir4Cell(function(t){return t.isPillow()},1,"nmPillowLt")},checkFullSizeFuton:function(){this.checkAllCell(function(t){return 41===t.qans||46===t.qans},"futonHalf")},checkEmptyCell_shugaku:function(){this.checkAllCell(function(t){return t.noNum()&&0===t.qans},"ceEmpty")},checkKitamakura:function(){for(var t=this.board,s=0;s<t.cell.length;s++){var e=t.cell[s];if(43===e.qans){if(this.failcode.add("kitamakura"),this.checkOnly)break;e.seterr(1),e.adjacent.bottom.seterr(1)}}},checkFutonAisle:function(){for(var t=this.board,s=0;s<t.cell.length;s++){var e=t.cell[s];if(!e.isNum()){var i=e.adjacent,n=null;switch(e.qans){case 42:n=i.top;break;case 43:n=i.bottom;break;case 44:n=i.left;break;case 45:n=i.right;break;default:continue}if(!(0<e.countDir4Cell(function(t){return t.isShade()})||0<n.countDir4Cell(function(t){return t.isShade()}))){if(this.failcode.add("futonMidPos"),this.checkOnly)break;e.seterr(1),n.seterr(1)}}}}}});
//# sourceMappingURL=shugaku.js.map