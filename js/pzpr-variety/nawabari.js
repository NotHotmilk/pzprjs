/*! @license pzpr.js v1375cc80 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,r){"object"==typeof module&&module.exports?module.exports=[e,r]:pzpr.classmgr.makeCustom(e,r)}(["nawabari","fourcells","fivecells","heteromino","subomino","narrow"],{MouseEvent:{autoedit_func:"qnum",autoplay_func:"border"},"MouseEvent@nawabari":{inputModes:{edit:["number","clear"],play:["border","subline"]}},"MouseEvent@fourcells,fivecells":{inputModes:{edit:["empty","number","clear"],play:["border","subline"]}},"MouseEvent@heteromino":{inputModes:{edit:["empty","clear"],play:["border","subline"]},mouseinputAutoEdit:function(){this.inputempty()}},"MouseEvent@fourcells,fivecells,subomino,narrow":{inputModes:{edit:["empty","number","clear"],play:["border","subline"]},mouseinput_clear:function(){this.inputFixedNumber(-1)}},KeyEvent:{enablemake:!0},"KeyEvent@fourcells,fivecells,subomino,heteromino":{keyinput:function(e){"w"===e?this.key_inputvalid(e):"heteromino"!==this.pid&&this.key_inputqnum(e)},key_inputvalid:function(e){"w"!==e||(e=this.cursor.getc()).isnull||e.setValid(7!==e.ques?7:0)}},Cell:{getdir4BorderCount:function(){for(var e=0,r=this.getdir4cblist(),i=0;i<r.length;i++){var t=r[i][0],o=r[i][1];(t.isnull||t.isEmpty()||o.isBorder())&&e++}return e}},"Cell@nawabari":{maxnum:4,minnum:0},"Cell@fourcells":{maxnum:3},"Cell@fivecells":{maxnum:3,minnum:0},"Cell@narrow":{maxnum:4,disInputHatena:!0},"Cell@subomino":{maxnum:function(){return this.board.cols*this.board.rows},minnum:2,posthook:{qnum:function(e){this.room&&this.board.roommgr.setExtraData(this.room)}}},"CellList@heteromino":{triminoShape:function(){if(3!==this.length)return-1;for(var e=this.getRectSize(),r=0,i=0;i<this.length;i++){var t=this[i],o=t.bx-e.x1>>1,t=t.by-e.y1>>1;2<=o||2<=t||(r+=1<<o+2*t)}return r}},"CellList@subomino":{seterr:function(r){this.each(function(e){r>e.error&&(e.error=r)})}},Border:{isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isBorder:function(){return 0<this.qans||this.isQuesBorder()},isQuesBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())},prehook:{qans:function(){return!this.isGrid()},qsub:function(){return!this.isGrid()}}},Board:{hasborder:2},"Board@fourcells,fivecells":{initBoardSize:function(e,r){this.common.initBoardSize.call(this,e,r);e=e*r%("fivecells"===this.pid?5:4);1<=e&&(this.getc(this.minbx+1,this.minby+1).ques=7),2<=e&&(this.getc(this.maxbx-1,this.minby+1).ques=7),3<=e&&(this.getc(this.minbx+1,this.maxby-1).ques=7),4<=e&&(this.getc(this.maxbx-1,this.maxby-1).ques=7)}},AreaRoomGraph:{enabled:!0},"AreaRoomGraph@subomino":{setExtraData:function(r){r.clist=new this.klass.CellList(r.getnodeobjs()),r.valid=!r.clist.some(function(e){return 0<e.qnum&&e.qnum!==r.clist.length})}},"AreaRoomGraph@narrow":{setExtraData:function(e){var r=(e.clist=new this.klass.CellList(e.getnodeobjs())).filter(function(e){return e.isNum()});e.num=1===r.length?r[0].getNum():-1}},Graphic:{gridcolor_type:"DLIGHT",numbercolor_func:"qnum",paint:function(){this.drawBGCells(),this.drawValidDashedGrid(),this.drawQansBorders(),this.drawQuesBorders(),"heteromino"!==this.pid&&"subomino"!==this.pid||(this.drawCircles(),this.drawChassis()),this.drawQuesNumbers(),this.drawBorderQsubs(),this.drawTarget()},getQuesBorderColor:function(e){return e.isQuesBorder()?this.quescolor:null},drawValidDashedGrid:function(){for(var e=this.vinc("grid_waritai","crispEdges",!0),r=this.getDashArray(),i=(e.lineWidth=1,e.strokeStyle=this.gridcolor,this.range.borders),t=0;t<i.length;t++){var o,s,n=i[t];e.vid="b_grid_wari_"+n.id,n.isGrid()?(o=n.bx*this.bw,s=n.by*this.bh,n.isVert()?e.strokeDashedLine(o,s-this.bh,o,s+this.bh,r):e.strokeDashedLine(o-this.bw,s,o+this.bw,s,r)):e.vhide()}}},"Graphic@heteromino,subomino":{errbcolor2:"rgb(255, 216, 216)",circlestrokecolor_func:"null",circleratio:[.35,.35],getBGCellColor:function(e){if(!e.isValid())return"black";e=e.error||e.qinfo;return 1===e||3===e?this.errbcolor1:2===e?this.errbcolor2:null},getCircleFillColor:function(e){return 3===e.error?this.errbcolor2:null}},"Graphic@narrow":{drawQuesNumbers:function(){for(var e=this.vinc("cell_mark","auto"),r=(e.lineWidth=Math.max(this.cw/18,2),.3*this.cw),i=this.range.cells,t=0;t<i.length;t++){var o=i[t],s=(e.vid="c_mk_"+o.id,e.strokeStyle=this.getQuesNumberColor(o),o.bx*this.bw),n=o.by*this.bh;switch(o.getNum()){case 1:e.strokeCircle(s,n,r);break;case 2:e.beginPath(),e.moveTo(s-r,n),e.lineTo(s+r,n),e.moveTo(s,n-r),e.lineTo(s,n+r),e.stroke();break;case 3:e.strokeCross(s,n,r);break;case 4:e.beginPath(),e.setOffsetLinePath(s,n,0,-r,r,0,0,r,-r,0,!0),e.stroke();break;default:e.vhide()}}}},Encode:{decodePzpr:function(e){this.decodeFivecells()},encodePzpr:function(e){this.encodeFivecells()},decodeFivecells:function(){for(var e=0;e<this.board.cell.length;e++)this.board.cell[e].setQues(0);for(var e=0,r=0,i=this.outbstr,t=this.board,r=0;r<i.length;r++){var o=t.cell[e],s=i.charAt(r);if(o.ques=0,"7"===s?o.ques=7:"."===s?o.qnum=-2:this.include(s,"0","9")?o.qnum=parseInt(s,10):this.include(s,"a","z")&&(e+=parseInt(s,36)-10),++e>=t.cell.length)break}this.outbstr=i.substr(r)},encodeFivecells:function(){for(var e="",r=0,i=this.board,t=0;t<i.cell.length;t++){var o="",s=i.cell[t].qnum;7===i.cell[t].ques?o="7":-2===s?o=".":-1!==s?o=s.toString(10):r++,0===r?e+=o:!o&&26!==r||(e+=(9+r).toString(36)+o,r=0)}0<r&&(e+=(9+r).toString(36)),this.outbstr+=e}},"Encode@subomino,narrow":{decodePzpr:function(e){this.decodeNumber16(),this.decodeEmpty()},encodePzpr:function(e){this.encodeNumber16(),this.encodeEmpty()}},FileIO:{decodeData:function(){this.decodeCell(function(e,r){e.ques=0,"*"===r?e.ques=7:"-"===r?e.qnum=-2:"."!==r&&(e.qnum=+r)}),this.decodeBorderAns("fourcells"===this.pid&&0===this.filever?1:null)},encodeData:function(){"fourcells"===this.pid&&(this.filever=1),this.encodeCell(function(e){return 7===e.ques?"* ":-2===e.qnum?"- ":0<=e.qnum?e.qnum+" ":". "}),this.encodeBorderAns()}},AnsCheck:{checklist:["checkOverThreeCells@heteromino","checkTouchDifferent@heteromino","checkLessThreeCells@heteromino","checkRoomRect@nawabari","checkRoom2x2@narrow","checkRoomIdentical@narrow","checkNoNumber@nawabari,narrow","checkRoomNotRect@narrow","checkDoubleNumber@nawabari,narrow","checkOverFourCells@fourcells","checkOverFiveCells@fivecells","checkdir4BorderAns@!heteromino,!narrow","checkBorderDeadend+","checkLessFourCells@fourcells","checkLessFiveCells@fivecells"],checkOverThreeCells:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return 3<=i},"bkSizeLt3")},checkLessThreeCells:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return i<=3},"bkSizeGt3")},checkOverFourCells:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return 4<=i},"bkSizeLt4")},checkLessFourCells:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return i<=4},"bkSizeGt4")},checkOverFiveCells:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return 5<=i},"bkSizeLt5")},checkLessFiveCells:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return i<=5},"bkSizeGt5")},checkdir4BorderAns:function(){this.checkAllCell(function(e){return e.isValidNum()&&e.getdir4BorderCount()!==e.qnum},"nmBorderNe")},checkTouchDifferent:function(){for(var e=this.board,r=0;r<e.border.length;r++){var i=e.border[r];if(i.isBorder()){var t=i.sidecell[0],i=i.sidecell[1];if(t.isValid()&&i.isValid()){t=t.room.clist,i=i.room.clist;if(3===t.length&&3===i.length&&t.triminoShape()===i.triminoShape()){if(this.failcode.add("bkSameTouch"),this.checkOnly)return;t.seterr(1),i.seterr(1)}}}}}},"AnsCheck@subomino":{checklist:["checkAreaOverlap","checkNumberValid","checkBorderDeadend+"],checkAreaOverlap:function(){for(var e=this.board.roommgr.getSideAreaInfo(),r=0;r<e.length;r++){var i=e[r][0],t=e[r][1];if(i.valid&&t.valid){i.clist.length>t.clist.length&&(t=e[r][0],i=e[r][1]);for(var o=i.clist.getRectSize(),s=t.clist.getRectSize(),n=new this.klass.CellList,c=!1,l=0;!c&&l<=s.cols-o.cols;l++)for(var a=0;!c&&a<=s.rows-o.rows;a++){for(var h=0;h<i.clist.length;h++){var u=i.clist[h],u=this.board.getc(2*l+s.x1+u.bx-o.x1,2*a+s.y1+u.by-o.y1);if(u.isnull||u.room!==t)break;n.add(u)}h===i.clist.length?c=!0:n=new this.klass.CellList}if(c){if(this.failcode.add("bkOverlap"),this.checkOnly)break;n.seterr(3),i.clist.seterr(2),t.clist.seterr(1)}}}},checkNumberValid:function(){for(var e=this.board,r=0;r<e.roommgr.components.length;r++){var i=e.roommgr.components[r];if(!i.valid){if(this.failcode.add("bkSizeNe"),this.checkOnly)break;i.clist.seterr(1)}}}},"AnsCheck@narrow":{checkRoomNotRect:function(){this.checkAllArea(this.board.roommgr,function(e,r,i,t){return e*r!==i},"bkRect")},checkRoom2x2:function(){var e=this.board;e:for(var r=0;r<e.cell.length;r++){var i=e.cell[r],t=i.bx,i=i.by;if(!(t>=e.maxbx-1||i>=e.maxby-1)){var o=e.cellinside(t,i,t+2,i+2);if(o[0].room&&!(o[0].room.num<=0)){for(var s=1;s<4;s++)if(!o[s].room||o[0].room.num!==o[s].room.num)continue e;if(this.failcode.add("nmSame2x2"),this.checkOnly)break;o.seterr(1)}}}},checkRoomIdentical:function(){for(var e={},r=this.board.roommgr.components,i=0;i<r.length;i++){var t=r[i];if(!(t.num<=0)){var o=t.num+"",s=(o in e||(e[o]={}),t.clist.getBlockShapes().canon);if(s in e[o]){if(this.failcode.add("bkSameShape"),this.checkOnly)return;e[o][s].clist.seterr(1),t.clist.seterr(1)}else e[o][s]=t}}}}});