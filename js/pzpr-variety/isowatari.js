/*! @license pzpr.js v1375cc80 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["isowatari"],{MouseEvent:{use:!0,inputModes:{edit:["circle-shade","circle-unshade","empty","clear"],play:["shade","unshade","clear"]},inputEdit:function(){null===this.inputData?this.inputEdit_first():this.inputqnum()},inputEdit_first:function(){var t=this.board,e=this.inputPoint.bx,i=this.inputPoint.by,s=t.clusterSize.rect;if(e>=s.bx1&&e<=s.bx2&&i>=s.by1&&i<=s.by2){if(this.cursor.by>=t.minby)return e=new this.klass.Address(t.maxbx-1,-1),void this.setcursor(e);i=this.getNewNumber(t.clusterSize,t.clusterSize.count);null!==i&&(t.clusterSize.set(i),this.mousereset())}else this.inputqnum()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&this.mousestart&&this.inputEdit()},mouseinput_clear:function(){var t=this.getcell();t.isnull||t===this.mouseCell||(this.puzzle.editmode&&t.setQnum(-1),t.setQans(0),t.setQsub(0),t.draw())}},Cell:{numberAsObject:!0,disInputHatena:!0,maxnum:2,allowShade:function(){return 1!==this.qnum&&!this.isEmpty()},allowUnshade:function(){return 2!==this.qnum&&!this.isEmpty()},isUnshade:function(){return!this.isnull&&1!==this.qans&&!this.isEmpty()},isShadeDecided:function(){return this.isnull||this.isEmpty()||this.isShade()||0<this.qsub}},KeyEvent:{enablemake:!0,keyinput:function(t){var e;"w"===t?(e=this.cursor.getc()).isnull||e.setValid(7!==e.ques?7:0):this.cursor.by>=this.board.minby?this.key_inputqnum(t):this.key_inputqnum_isowatari(t)},key_inputqnum_isowatari:function(t){var e=this.puzzle.board,t=this.getNewNumber(e.clusterSize,t,e.clusterSize.count);null!==t&&(e.clusterSize.set(t),this.prev=e.clusterSize)}},TargetCursor:{draw:function(){this.by>=this.board.minby?this.common.draw.call(this):this.board.clusterSize.draw()}},Board:{hasborder:2,clusterSize:null,createExtraObject:function(){this.clusterSize=new this.klass.ClusterSize(1)},initExtraObject:function(t,e){this.clusterSize.init(1)}},AreaRoomGraph:{enabled:!0},Border:{isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isBorder:function(){return 0<this.qans||this.isQuesBorder()},isQuesBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())}},ClusterSize:{count:1,rect:null,initialize:function(t){this.count=t,this.rect={bx1:-1,by1:-1,bx2:-1,by2:-1}},init:function(t){this.count=t;t=this.puzzle.board;this.rect={bx1:t.maxbx-3.15,by1:-1.8,bx2:t.maxbx-.15,by2:-.2}},set:function(t){this.count!==(t=t<=0?1:t)&&(this.addOpe(this.count,t),this.count=t,this.draw(),this.board.autoSolve())},getmaxnum:function(){var t=this.board;return t.rows*t.cols},getminnum:function(){return 1},addOpe:function(t,e){this.puzzle.opemgr.add(new this.klass.ClusterSizeOperation(t,e))},draw:function(){this.puzzle.painter.paintRange(this.board.minbx,-1,this.board.maxbx,-1)}},"ClusterSizeOperation:Operation":{type:"clusterSize",setData:function(t,e){this.old=t,this.num=e},decode:function(t){return"AS"===t[0]&&(this.old=+t[1],this.num=+t[2],!0)},toString:function(){return["AS",this.old,this.num].join(",")},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.num)},exec:function(t){this.board.clusterSize.set(t)}},AreaShadeGraph:{enabled:!0},AreaUnshadeGraph:{enabled:!0,relation:{"cell.ques":"node","cell.qans":"node"}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.ClusterSizeOperation)}},Graphic:{gridcolor_type:"DLIGHT",enablebcolor:!0,shadecolor:"rgb(80, 80, 80)",circlefillcolor_func:"qnum2",circleratio:[.3,.25],trialbcolor:this.bcolor,numbercolor_func:"qnum",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawValidGrid(),this.drawQuesBorders(),this.drawCircles(),this.drawClusterSize(),this.drawCursor_isowatari()},getQuesBorderColor:function(t){return t.isQuesBorder()?this.quescolor:null},drawValidGrid:function(){for(var t=this.vinc("grid_waritai","crispEdges",!0),e=(t.lineWidth=1,t.strokeStyle=this.gridcolor,this.range.borders),i=0;i<e.length;i++){var s,n,r=e[i];t.vid="b_grid_wari_"+r.id,r.isGrid()?(s=r.bx*this.bw,n=r.by*this.bh,r.isVert()?t.strokeLine(s,n-this.bh,s,n+this.bh):t.strokeLine(s-this.bw,n,s+this.bw,n)):t.vhide()}},getCanvasRows:function(){return this.getBoardRows()+2*this.margin+.8},getOffsetRows:function(){return.4},setRangeObject:function(t,e,i,s){this.common.setRangeObject.call(this,t,e,i,s),this.range.clusterSize=e<0},copyBufferData:function(t,e,i,s,n,r){this.common.copyBufferData.call(this,t,e,i,s,n,r),t.use.canvas&&this.range.clusterSize&&(i=this.board,s=e.child.width,n=(i.minby-.1)*this.bh+this.y0,t.context.clearRect(0,0-this.y0,s,n),t.drawImage(e.child,0,0,+s,+n,0-this.x0,0-this.y0,+s,+n))},drawClusterSize:function(){var t=this.vinc("clustersize","auto",!0),e=this.board;this.range.clusterSize&&(t.use.canvas&&t.context.clearRect(0,-this.y0,t.child.width,(e.minby-.1)*this.bh+this.y0),t.fillStyle=this.quescolor,t.vid="bd_clusterSize",t.font=(.66*this.ch|0)+"px "+this.fontfamily,t.textAlign="right",t.textBaseline="middle",t.fillText(""+e.clusterSize.count,(e.maxbx-1)*this.bw,-this.bh))},drawCursor_isowatari:function(){var t=this.puzzle.board.minby<=this.puzzle.cursor.by,e=!t;this.drawCursor(!0,t&&this.puzzle.editmode),this.drawCursorOnIndicator(e)},drawCursorOnIndicator:function(t){var e=this.vinc("target_cursor","crispEdges",!0),i=this.board;this.range.clusterSize&&(t=t&&this.puzzle.editmode&&"auto"===this.puzzle.mouse.inputMode&&this.puzzle.getConfig("cursor")&&!this.outputImage,e.vid="ti",t?(t=i.clusterSize.rect,e.strokeStyle=this.targetColorEdit,e.lineWidth=0|Math.max(this.cw/16,2),e.strokeRect(t.bx1*this.bw,t.by1*this.bh,(t.bx2-t.bx1)*this.bw,(t.by2-t.by1)*this.bh)):e.vhide())}},Encode:{decodePzpr:function(t){this.decodeClusterSize(),this.decodeCircle(),this.decodeEmpty()},encodePzpr:function(t){this.encodeClusterSize(),this.encodeCircle(),this.encodeEmpty()},decodeClusterSize:function(){var t=this.outbstr.split("/");this.board.clusterSize.count=+t[0],this.outbstr=t[1]||""},encodeClusterSize:function(){this.outbstr=this.board.clusterSize.count+"/"}},FileIO:{decodeData:function(){this.board.clusterSize.count=+this.readLine(),this.decodeCell(function(t,e){t.ques=0,"*"===e?t.ques=7:"-"===e?t.qnum=-2:"."!==e&&(t.qnum=+e)}),this.decodeCellQnum(),this.decodeCellAnumsub(),this.decodeCellAns()},encodeData:function(){this.writeLine(this.board.clusterSize.count),this.encodeCell(function(t){return 7===t.ques?"* ":-2===t.qnum?"- ":0<=t.qnum?t.qnum+" ":". "}),this.encodeCellQnum(),this.encodeCellAnumsub(),this.encodeCellAns()}},AnsCheck:{checklist:["checkShadeOnCircle","checkUnshadeOnCircle","checkConnectUnshade","check2x2UnshadeCell","checkGreaterThanN","checkSmallerThanN","doneShadingDecided"],checkShadeOnCircle:function(){this.checkAllCell(function(t){return!t.isShade()&&2===t.qnum},"circleUnshade")},checkUnshadeOnCircle:function(){this.checkAllCell(function(t){return t.isShade()&&1===t.qnum},"circleShade")},checkGreaterThanN:function(){var n=this.board;this.checkAllArea(this.board.sblkmgr,function(t,e,i,s){return i<=n.clusterSize.count},"csGtN")},checkSmallerThanN:function(){var n=this.board;this.checkAllArea(this.board.sblkmgr,function(t,e,i,s){return i>=n.clusterSize.count},"csLtN")}}});